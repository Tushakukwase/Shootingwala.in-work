"use client"

import NextImage from "next/image"
import Link from "next/link"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"

import { useState, useEffect, useRef } from "react"
import { cn } from "@/lib/utils"
import { useAuth } from "@/contexts/AuthContext"

export function HomeContent() {
  const { user, isAuthenticated } = useAuth()
  const [categoriesScroll, setCategoriesScroll] = useState(0)
  const [citiesScroll, setCitiesScroll] = useState(0)
  const [categories, setCategories] = useState<{ name: string; image: string }[]>([])
  const [cities, setCities] = useState<{ name: string; image: string }[]>([])
  const [stories, setStories] = useState<{ title: string; content: string; imageUrl: string; date: string }[]>([])
  const [galleryImages, setGalleryImages] = useState<{ category: string; imageUrl: string; uploaderName: string }[]>([])
  const [galleryCategories, setGalleryCategories] = useState<{ name: string; imageCount: number; sampleImage: string; allImages?: string[]; sources?: string[] }[]>([])
  const [currentStoryIndex, setCurrentStoryIndex] = useState(0)
  const [approvedPhotographers, setApprovedPhotographers] = useState<any[]>([])
  const [userPreferences, setUserPreferences] = useState<any>(null)
  const categoriesContainerRef = useRef<HTMLDivElement>(null);
  const citiesContainerRef = useRef<HTMLDivElement>(null);
  const galleryScrollRef = useRef<HTMLDivElement>(null);
  const storiesScrollRef = useRef<HTMLDivElement>(null);
  const storiesIntervalRef = useRef<NodeJS.Timeout | null>(null);
  const [categoriesAnimationId, setCategoriesAnimationId] = useState<number | null>(null);
  const [citiesAnimationId, setCitiesAnimationId] = useState<number | null>(null);
  const [galleryAnimationId, setGalleryAnimationId] = useState<number | null>(null);
  const [storiesAnimationId, setStoriesAnimationId] = useState<number | null>(null);
  const [albumData, setAlbumData] = useState<{ imageUrl: string | null; title: string; description: string }>({
    imageUrl: null,
    title: '',
    description: ''
  })
  const [invitationData, setInvitationData] = useState<{ 
    imageUrl: string | null; 
    eventTitle: string; 
    eventDate: string; 
    eventLocation: string; 
    description: string 
  }>({
    imageUrl: null,
    eventTitle: '',
    eventDate: '',
    eventLocation: '',
    description: ''
  })
  const [expandedAlbum, setExpandedAlbum] = useState(false)
  const [expandedInvitation, setExpandedInvitation] = useState(false)

  // Function to get photographer recommendations
  const fetchApprovedPhotographers = async () => {
    try {
      let photographers: any[] = [];
      
      if (isAuthenticated && user) {
        // Try to fetch user preferences and activity first
        try {
          const preferencesRes = await fetch(`/api/user-preferences/${user.id}`);
          if (preferencesRes.ok) {
            const preferences = await preferencesRes.json();
            setUserPreferences(preferences);
            
            // If user has preferences, fetch personalized recommendations
            if (preferences && !preferences.isNewUser && 
                (preferences.preferredCategories?.length > 0 || 
                 preferences.preferredLocation || 
                 preferences.priceRange)) {
              
              const params = new URLSearchParams({
                approved: 'true',
                userId: user.id,
                personalized: 'true'
              });
              
              if (preferences.preferredCategories?.length > 0) {
                params.append('categories', preferences.preferredCategories.join(','));
              }
              if (preferences.preferredLocation) {
                params.append('location', preferences.preferredLocation);
              }
              if (preferences.priceRange) {
                params.append('priceRange', preferences.priceRange);
              }
              
              const photographersRes = await fetch(`/api/photographers?${params.toString()}`);
              if (photographersRes.ok) {
                const data = await photographersRes.json();
                photographers = data.photographers || [];
              }
            }
          }
        } catch (prefError) {
          // Continue with default fetch if preferences fail
        }
      }
      
      // If no personalized results or user not authenticated, fetch all approved photographers
      if (photographers.length === 0) {
        const res = await fetch('/api/photographers?approved=true');
        if (res.ok) {
          const data = await res.json();
          photographers = data.photographers || [];
        }
      }
      
      // ENHANCED FIX: Prioritize real studio names from database
      photographers = photographers.map((p: any) => {
        // Priority: Real studio name from database
        let studioName;
        
        if (p.studioName && p.studioName.trim() !== '') {
          // Use real studio name from database
          studioName = p.studioName;
        } else {
          // Only generate fallback if no real studio name exists
          studioName = p.name && p.name !== p.email ? 
                      `${p.name} Photography Studio` : 
                      p.email ? `${p.email.split('@')[0]} Photography Studio` : 
                      'Professional Photography Studio';
        }
        
        // Get best available image for studio banner (prioritize studio banner)
        const studioBannerImage = p.studioBannerImage || 
                                 p.bannerImage || 
                                 p.image || 
                                 p.profileImage || 
                                 'https://images.unsplash.com/photo-1606983340126-99ab4feaa64a?w=400&h=300&fit=crop&crop=center';
        
        return {
          ...p,
          studioName,
          studioBannerImage,
          // Ensure name is clean (not email)
          displayName: p.name && p.name !== p.email ? p.name : p.email?.split('@')[0] || 'Photographer'
        };
      });
      
      // Debug: Log photographer data to see what we're getting
      console.log('=== PHOTOGRAPHER DATA DEBUG ===');
      console.log('Total photographers fetched:', photographers.length);
      photographers.slice(0, 3).forEach((p: any, index: number) => {
        console.log(`Photographer ${index + 1}:`, {
          id: p._id,
          name: p.name,
          originalStudioName: p.studioName,
          finalStudioName: p.studioName && p.studioName.trim() !== '' ? p.studioName : 'FALLBACK_GENERATED',
          studioBannerImage: p.studioBannerImage,
          bannerImage: p.bannerImage,
          profileImage: p.profileImage,
          image: p.image,
          location: p.location
        });
      });
      console.log('=== END DEBUG ===');
      
      // Apply smart sorting for better recommendations
      const sortedPhotographers = photographers.sort((a: any, b: any) => {
        // Prioritize photographers with higher ratings
        if (b.rating !== a.rating) {
          return (b.rating || 0) - (a.rating || 0);
        }
        // Then by experience
        if (b.experience !== a.experience) {
          return (b.experience || 0) - (a.experience || 0);
        }
        // Finally by creation date (newer first)
        return new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime();
      });
      
      setApprovedPhotographers(sortedPhotographers);
      
    } catch (error) {
      // Silently handle error
      console.error('Error fetching photographers:', error);
      setApprovedPhotographers([]);
    }
  };

  useEffect(() => {
    // Fetch homepage items (approved categories and cities with show_on_home = true)
    fetch('/api/homepage-items')
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          setCategories(data.data.categories || []);
          setCities(data.data.cities || []);
        }
      })
      .catch(err => {
        // Silently handle error - fallback to existing APIs if homepage-items fails
        fetch('/api/categories')
          .then(res => res.json())
          .then(data => {
            const allCategories = data.categories || [];
            const selectedCategories = allCategories.filter((cat: any) => cat.selected);
            setCategories(selectedCategories.length > 0 ? selectedCategories : allCategories);
          });
        
        fetch('/api/cities')
          .then(res => res.json())
          .then(data => {
            const allCities = data.cities || [];
            const selectedCities = allCities.filter((city: any) => city.selected);
            setCities(selectedCities.length > 0 ? selectedCities : allCities);
          });
      });

    // Fetch digital album data
    fetch('/api/digital-album')
      .then(res => res.json())
      .then(data => {
        setAlbumData(data);
      })
      .catch(err => {/* Silently handle error */});

    // Fetch digital invitation data
    fetch('/api/digital-invitation')
      .then(res => res.json())
      .then(data => {
        setInvitationData(data);
      })
      .catch(err => {/* Silently handle error */});

    // Fetch stories data (including photographer stories)
    Promise.all([
      fetch('/api/stories').then(res => res.json()),
      fetch('/api/photographer-stories').then(res => res.json())
    ])
    .then(([adminStoriesData, photographerStoriesData]) => {
      const adminStories = adminStoriesData.stories || [];
      const photographerStories = photographerStoriesData.stories || [];
      
      // Filter photographer stories that are approved and should show on home
      const approvedPhotographerStories = photographerStories
        .filter((story: any) => story.status === 'approved' && story.showOnHome)
        .map((story: any) => ({
          _id: story.id,
          title: story.title,
          content: story.content,
          imageUrl: story.coverImage,
          date: story.date,
          location: story.location,
          photographer: story.photographerName || 'Photographer'
        }));
      
      // Combine admin stories with approved photographer stories
      setStories([...adminStories, ...approvedPhotographerStories]);
    })
    .catch(err => {/* Silently handle error */});

    // Fetch gallery images and categories (including photographer galleries)
    Promise.all([
      fetch('/api/gallery/images').then(res => res.json()),
      fetch('/api/gallery/categories').then(res => res.json()),
      fetch('/api/photographer-galleries').then(res => res.json())
    ])
    .then(([imagesData, categoriesData, photographerGalleriesData]) => {
      const images = imagesData.images || [];
      const categories = categoriesData.categories || [];
      const photographerGalleries = photographerGalleriesData.galleries || [];
      
      setGalleryImages(images);
      
      // Group all galleries by name to avoid duplicates
      const allGalleryData: { [key: string]: { images: string[], sources: string[] } } = {};
      
      // Add admin categories
      categories.forEach((cat: any) => {
        const categoryImages = images.filter((img: any) => img.category === cat.name);
        if (categoryImages.length > 0) {
          if (!allGalleryData[cat.name]) {
            allGalleryData[cat.name] = { images: [], sources: [] };
          }
          allGalleryData[cat.name].images.push(...categoryImages.map((img: any) => img.imageUrl));
          allGalleryData[cat.name].sources.push('Admin');
        }
      });
      
      // Add approved photographer galleries
      photographerGalleries
        .filter((gallery: any) => gallery.status === 'approved' && gallery.showOnHome)
        .forEach((gallery: any) => {
          if (gallery.images && gallery.images.length > 0) {
            if (!allGalleryData[gallery.name]) {
              allGalleryData[gallery.name] = { images: [], sources: [] };
            }
            allGalleryData[gallery.name].images.push(...gallery.images);
            allGalleryData[gallery.name].sources.push(gallery.photographerName || 'Photographer');
          }
        });
      
      // Convert to array format for display
      const groupedGalleries = Object.entries(allGalleryData).map(([name, data]) => ({
        name,
        imageCount: data.images.length,
        sampleImage: data.images[0] || '/placeholder.svg?height=200&width=200',
        allImages: data.images,
        sources: [...new Set(data.sources)] // Remove duplicate sources
      }));
      
      setGalleryCategories(groupedGalleries);
    })
    .catch(err => {/* Silently handle error */});

    // Fetch approved photographers
    fetchApprovedPhotographers();
  }, [isAuthenticated, user?.id]);


  const nextStory = () => {
    // Not needed with continuous scrolling
  };

  const prevStory = () => {
    // Not needed with continuous scrolling
  };

  // Function to track user activity
  const trackUserActivity = async (photographerId: string, action: string) => {
    if (isAuthenticated && user) {
      try {
        await fetch(`/api/user-preferences/${user.id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            photographerId,
            action,
          }),
        });
      } catch (error) {
        console.error('Failed to track user activity:', error);
      }
    }
  };


  // Continuous smooth auto-scroll for categories
  useEffect(() => {
    if (categories.length > 4 && categoriesContainerRef.current) {
      const scrollContainer = categoriesContainerRef.current;
      const cardWidth = 272; // card width + gap
      const originalWidth = categories.length * cardWidth;
      let scrollPosition = 0;
      let animationId: number;

      const smoothScroll = () => {
        scrollPosition += 0.5; // Slow continuous movement
        
        // Seamless loop - when reaching halfway through duplicates, reset to beginning
        if (scrollPosition >= originalWidth) {
          scrollPosition = 0;
          scrollContainer.scrollLeft = 0;
        } else {
          scrollContainer.scrollLeft = scrollPosition;
        }
        
        animationId = requestAnimationFrame(smoothScroll);
      };

      // Start the continuous scroll
      animationId = requestAnimationFrame(smoothScroll);

      setCategoriesAnimationId(animationId);

      return () => {
        if (animationId) {
          cancelAnimationFrame(animationId);
        }
      };
    }
  }, [categories.length]);

  // Continuous smooth auto-scroll for cities
  useEffect(() => {
    if (cities.length > 4 && citiesContainerRef.current) {
      const scrollContainer = citiesContainerRef.current;
      const cardWidth = 272; // card width + gap
      const originalWidth = cities.length * cardWidth;
      let scrollPosition = 0;
      let animationId: number;

      const smoothScroll = () => {
        scrollPosition += 0.5; // Slow continuous movement
        
        // Seamless loop - when reaching halfway through duplicates, reset to beginning
        if (scrollPosition >= originalWidth) {
          scrollPosition = 0;
          scrollContainer.scrollLeft = 0;
        } else {
          scrollContainer.scrollLeft = scrollPosition;
        }
        
        animationId = requestAnimationFrame(smoothScroll);
      };

      // Start the continuous scroll
      animationId = requestAnimationFrame(smoothScroll);

      setCitiesAnimationId(animationId);

      return () => {
        if (animationId) {
          cancelAnimationFrame(animationId);
        }
      };
    }
  }, [cities.length]);

  // Continuous smooth auto-scroll for gallery
  useEffect(() => {
    if (galleryCategories.length > 5 && galleryScrollRef.current) {
      const scrollContainer = galleryScrollRef.current;
      const cardWidth = 280; // card width + gap
      const originalWidth = galleryCategories.length * cardWidth;
      let scrollPosition = 0;
      let animationId: number;

      const smoothScroll = () => {
        scrollPosition += 0.5; // Slow continuous movement
        
        // Seamless loop - when reaching halfway through duplicates, reset to beginning
        if (scrollPosition >= originalWidth) {
          scrollPosition = 0;
          scrollContainer.scrollLeft = 0;
        } else {
          scrollContainer.scrollLeft = scrollPosition;
        }
        
        animationId = requestAnimationFrame(smoothScroll);
      };

      // Start the continuous scroll
      animationId = requestAnimationFrame(smoothScroll);

      setGalleryAnimationId(animationId);

      return () => {
        if (animationId) {
          cancelAnimationFrame(animationId);
        }
      };
    }
  }, [galleryCategories.length]);

  // Continuous smooth auto-scroll for stories
  useEffect(() => {
    if (stories.length > 3 && storiesScrollRef.current) {
      const scrollContainer = storiesScrollRef.current;
      const cardWidth = 352; // card width + gap
      const originalWidth = stories.length * cardWidth;
      let scrollPosition = 0;
      let animationId: number;

      const smoothScroll = () => {
        scrollPosition += 0.5; // Slow continuous movement
        
        // Seamless loop - when reaching halfway through duplicates, reset to beginning
        if (scrollPosition >= originalWidth) {
          scrollPosition = 0;
          scrollContainer.scrollLeft = 0;
        } else {
          scrollContainer.scrollLeft = scrollPosition;
        }
        
        animationId = requestAnimationFrame(smoothScroll);
      };

      // Start the continuous scroll
      animationId = requestAnimationFrame(smoothScroll);

      setStoriesAnimationId(animationId);

      return () => {
        if (animationId) {
          cancelAnimationFrame(animationId);
        }
      };
    }
  }, [stories.length]);

  // Cleanup intervals and animations on unmount
  useEffect(() => {
    return () => {
      if (storiesIntervalRef.current) {
        clearInterval(storiesIntervalRef.current);
      }
      if (categoriesAnimationId) {
        cancelAnimationFrame(categoriesAnimationId);
      }
      if (citiesAnimationId) {
        cancelAnimationFrame(citiesAnimationId);
      }
      if (galleryAnimationId) {
        cancelAnimationFrame(galleryAnimationId);
      }
      if (storiesAnimationId) {
        cancelAnimationFrame(storiesAnimationId);
      }
    };
  }, [categoriesAnimationId, citiesAnimationId, galleryAnimationId, storiesAnimationId]);

  return (
    <>
      {/* Recommended For You - Recreated */}
      <section className="py-12 bg-gradient-to-br from-gray-50 to-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="space-y-8">
            {/* Section Header */}
            <div className="text-center">
              <h2 className="text-3xl font-bold text-gray-900 mb-2">
                {isAuthenticated ? '‚≠ê Recommended for You' : '‚≠ê Featured Photography Studios'}
              </h2>
              <p className="text-gray-600 max-w-2xl mx-auto">
                {isAuthenticated 
                  ? 'Discover talented photographers and studios based on your preferences'
                  : 'Explore our curated selection of professional photography studios and photographers'
                }
              </p>
            </div>
            
            {/* Photographers Grid */}
            {approvedPhotographers.length === 0 ? (
              <div className="text-center py-16">
                <div className="bg-white rounded-2xl shadow-sm border p-12 max-w-md mx-auto">
                  <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span className="text-2xl">üì∏</span>
                  </div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-2">No Studios Available</h3>
                  <p className="text-gray-500">
                    We're working on adding more talented photographers to our platform. Check back soon!
                  </p>
                </div>
              </div>
            ) : (
              <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                {approvedPhotographers.slice(0, 8).map((photographer) => (
                  <div key={photographer._id} className="group">
                    <Link href={`/photographer/${photographer._id}`}>
                      <Card className="overflow-hidden bg-white border-0 shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-2 cursor-pointer">
                        {/* Studio Banner Image */}
                        <div className="relative h-48 w-full overflow-hidden">
                          <NextImage
                            src={photographer.studioBannerImage}
                            alt={`${photographer.studioName || photographer.name} - Studio Banner`}
                            fill
                            sizes="(min-width: 1280px) 25vw, (min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw"
                            className="object-cover group-hover:scale-105 transition-transform duration-300"
                          />
                          
                          {/* Rating Badge */}
                          {photographer.rating > 0 && (
                            <div className="absolute top-3 right-3 bg-white/90 backdrop-blur-sm text-gray-900 px-3 py-1 rounded-full text-sm font-semibold shadow-sm">
                              ‚≠ê {photographer.rating.toFixed(1)}
                            </div>
                          )}
                          
                          {/* Verified Badge */}
                          {photographer.isVerified && (
                            <div className="absolute top-3 left-3 bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium">
                              ‚úì Verified
                            </div>
                          )}
                        </div>
                        
                        {/* Studio Information */}
                        <CardContent className="p-5 space-y-4">
                          {/* Studio Name & Location */}
                          <div>
                            <h3 className="text-lg font-bold text-gray-900 mb-1 line-clamp-1">
                              {photographer.studioName}
                            </h3>
                            <p className="text-sm text-gray-600 flex items-center">
                              <span className="mr-1">üìç</span>
                              {photographer.location || 'Location not specified'}
                            </p>

                          </div>
                          
                          {/* Specializations */}
                          <div className="flex flex-wrap gap-1">
                            {(photographer.specializations || photographer.categories || photographer.tags || [])
                              .slice(0, 3)
                              .map((specialization: string, index: number) => (
                                <span 
                                  key={index}
                                  className="inline-block bg-gradient-to-r from-yellow-100 to-orange-100 text-gray-800 text-xs px-2 py-1 rounded-full font-medium"
                                >
                                  {specialization}
                                </span>
                              ))
                            }
                          </div>
                          
                          {/* Experience & Stats */}
                          <div className="flex items-center justify-between text-sm">
                            <div className="flex items-center space-x-3">
                              {photographer.experience > 0 && (
                                <span className="text-gray-600">
                                  üìÖ {photographer.experience}+ years
                                </span>
                              )}
                            </div>
                            <div className="text-right">
                              <span className="text-lg font-bold text-gray-900">
                                ‚Çπ{photographer.startingPrice || 5000}+
                              </span>
                              <p className="text-xs text-gray-500">Starting from</p>
                            </div>
                          </div>
                          
                          {/* Action Button */}
                          <Button 
                            className="w-full bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-black font-semibold rounded-xl transition-all duration-300 hover:shadow-lg"
                            onClick={(e) => {
                              e.preventDefault()
                              trackUserActivity(photographer._id, 'profile_viewed')
                              window.location.href = `/photographer/${photographer._id}`
                            }}
                          >
                            <span className="mr-2">üëÅÔ∏è</span>
                            View Studio Profile
                          </Button>
                        </CardContent>
                      </Card>
                    </Link>
                  </div>
                ))}
              </div>
            )}
            
            {/* View All Button */}
            {approvedPhotographers.length > 0 && (
              <div className="text-center pt-8">
                <Link href="/photographers">
                  <Button 
                    variant="outline" 
                    size="lg"
                    className="bg-white border-2 border-gray-200 hover:border-yellow-400 hover:bg-yellow-50 text-gray-900 font-semibold px-8 py-3 rounded-xl transition-all duration-300"
                  >
                    View All Photography Studios ‚Üí
                  </Button>
                </Link>
              </div>
            )}
          </div>
        </div>
      </section>

      {/* Popular Searches Categories */}
      <section className="py-16 bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 className="text-3xl font-bold text-center mb-12 text-gray-900">Popular Searches Categories</h2>
          <div className="relative overflow-hidden group">
            <div
              ref={categoriesContainerRef}
              className="flex gap-5 touch-pan-x"
              style={{ width: 'max-content', cursor: 'grab' }}
              onMouseDown={(e) => {
                // Pause animation on mouse down and enable manual scrolling
                if (categoriesAnimationId) {
                  cancelAnimationFrame(categoriesAnimationId);
                  setCategoriesAnimationId(null);
                }
                
                const scrollContainer = categoriesContainerRef.current;
                if (!scrollContainer) return;
                
                const startX = e.pageX - scrollContainer.offsetLeft;
                const scrollLeft = scrollContainer.scrollLeft;
                
                const handleMouseMove = (moveEvent: MouseEvent) => {
                  moveEvent.preventDefault();
                  const x = moveEvent.pageX - scrollContainer.offsetLeft;
                  const walk = (x - startX) * 2; // Scroll speed multiplier
                  scrollContainer.scrollLeft = scrollLeft - walk;
                };
                
                const handleMouseUp = () => {
                  document.removeEventListener('mousemove', handleMouseMove);
                  document.removeEventListener('mouseup', handleMouseUp);
                  
                  // Resume animation after manual scrolling
                  setTimeout(() => {
                    if (categories.length > 0 && categoriesContainerRef.current) {
                      const scrollContainer = categoriesContainerRef.current;
                      const cardWidth = 180;
                      const originalWidth = categories.length * cardWidth;
                      let scrollPosition = scrollContainer.scrollLeft;
                      let animationId: number;

                      const smoothScroll = () => {
                        scrollPosition += 0.3;
                        
                        if (scrollPosition >= originalWidth) {
                          scrollPosition = 0;
                          scrollContainer.scrollLeft = 0;
                        } else {
                          scrollContainer.scrollLeft = scrollPosition;
                        }
                        
                        animationId = requestAnimationFrame(smoothScroll);
                        setCategoriesAnimationId(animationId);
                      };

                      animationId = requestAnimationFrame(smoothScroll);
                      setCategoriesAnimationId(animationId);
                    }
                  }, 3000); // Resume after 3 seconds of inactivity
                };
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
              }}
              onMouseEnter={() => {
                // Pause animation on hover
                if (categoriesAnimationId) {
                  cancelAnimationFrame(categoriesAnimationId);
                  setCategoriesAnimationId(null);
                }
              }}
              onMouseLeave={() => {
                // Resume animation when not hovering
                if (categories.length > 0 && categoriesContainerRef.current) {
                  const scrollContainer = categoriesContainerRef.current;
                  const cardWidth = 180;
                  const originalWidth = categories.length * cardWidth;
                  let scrollPosition = scrollContainer.scrollLeft;
                  let animationId: number;

                  const smoothScroll = () => {
                    scrollPosition += 0.3; // Slower, smoother continuous movement
                    
                    // Seamless loop - when reaching halfway through duplicates, reset to beginning
                    if (scrollPosition >= originalWidth) {
                      scrollPosition = 0;
                      scrollContainer.scrollLeft = 0;
                    } else {
                      scrollContainer.scrollLeft = scrollPosition;
                    }
                    
                    animationId = requestAnimationFrame(smoothScroll);
                    setCategoriesAnimationId(animationId);
                  };

                  animationId = requestAnimationFrame(smoothScroll);
                  setCategoriesAnimationId(animationId);
                }
              }}
              onTouchStart={(e) => {
                // Pause animation on touch
                if (categoriesAnimationId) {
                  cancelAnimationFrame(categoriesAnimationId);
                  setCategoriesAnimationId(null);
                }
              }}
              onTouchEnd={() => {
                // Resume animation after touch
                setTimeout(() => {
                  if (categories.length > 0 && categoriesContainerRef.current) {
                    const scrollContainer = categoriesContainerRef.current;
                    const cardWidth = 180;
                    const originalWidth = categories.length * cardWidth;
                    let scrollPosition = scrollContainer.scrollLeft;
                    let animationId: number;

                    const smoothScroll = () => {
                      scrollPosition += 0.3; // Consistent speed
                      
                      if (scrollPosition >= originalWidth) {
                        scrollPosition = 0;
                        scrollContainer.scrollLeft = 0;
                      } else {
                        scrollContainer.scrollLeft = scrollPosition;
                      }
                      
                      animationId = requestAnimationFrame(smoothScroll);
                      setCategoriesAnimationId(animationId);
                    };

                    animationId = requestAnimationFrame(smoothScroll);
                    setCategoriesAnimationId(animationId);
                  }
                }, 3000); // Resume after 3 seconds of inactivity
              }}
            >
              {/* Render original items */}
              {categories.map((category, index) => (
                <Link
                  key={`category-original-${index}`}
                  href={`/wedding-photographers?category=${encodeURIComponent(category.name)}`}
                  className="inline-block align-top flex-shrink-0 w-44"
                >
                  <Card className="shadow-lg hover:shadow-xl transition-shadow inline-block align-top cursor-pointer h-full flex flex-col">
                    <CardContent className="p-0 flex-grow flex flex-col">
                      <div className="relative h-36 flex-grow">
                        {category.image ? (
                          <img
                            src={category.image}
                            alt={category.name}
                            className="object-cover rounded-t-lg w-full h-full"
                          />
                        ) : (
                          <NextImage
                            src="/placeholder.svg"
                            alt={category.name}
                            fill
                            className="object-cover rounded-t-lg"
                          />
                        )}
                      </div>
                      <div className="p-4 flex items-center justify-center flex-grow">
                        <h3 className="text-sm font-semibold text-center text-gray-900">{category.name}</h3>
                      </div>
                    </CardContent>
                  </Card>
                </Link>
              ))}
              
              {/* Render duplicate items for seamless loop */}
              {categories.map((category, index) => (
                <Link
                  key={`category-duplicate-${index}`}
                  href={`/wedding-photographers?category=${encodeURIComponent(category.name)}`}
                  className="inline-block align-top flex-shrink-0 w-44"
                >
                  <Card className="shadow-lg hover:shadow-xl transition-shadow inline-block align-top cursor-pointer h-full flex flex-col">
                    <CardContent className="p-0 flex-grow flex flex-col">
                      <div className="relative h-36 flex-grow">
                        {category.image ? (
                          <img
                            src={category.image}
                            alt={category.name}
                            className="object-cover rounded-t-lg w-full h-full"
                          />
                        ) : (
                          <NextImage
                            src="/placeholder.svg"
                            alt={category.name}
                            fill
                            className="object-cover rounded-t-lg"
                          />
                        )}
                      </div>
                      <div className="p-4 flex items-center justify-center flex-grow">
                        <h3 className="text-sm font-semibold text-center text-gray-900">{category.name}</h3>
                      </div>
                    </CardContent>
                  </Card>
                </Link>
              ))}
            </div>
          </div>
        </div>
      </section>

      {/* Popular Searches Cities */}
      <section className="py-16 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 className="text-3xl font-bold text-center mb-12 text-gray-900">Popular Searches Cities</h2>
          <div className="relative overflow-hidden group">
            <div
              ref={citiesContainerRef}
              className="flex gap-5 touch-pan-x"
              style={{ width: 'max-content', cursor: 'grab' }}
              onMouseDown={(e) => {
                // Pause animation on mouse down and enable manual scrolling
                if (citiesAnimationId) {
                  cancelAnimationFrame(citiesAnimationId);
                  setCitiesAnimationId(null);
                }
                
                const scrollContainer = citiesContainerRef.current;
                if (!scrollContainer) return;
                
                const startX = e.pageX - scrollContainer.offsetLeft;
                const scrollLeft = scrollContainer.scrollLeft;
                
                const handleMouseMove = (moveEvent: MouseEvent) => {
                  moveEvent.preventDefault();
                  const x = moveEvent.pageX - scrollContainer.offsetLeft;
                  const walk = (x - startX) * 2; // Scroll speed multiplier
                  scrollContainer.scrollLeft = scrollLeft - walk;
                };
                
                const handleMouseUp = () => {
                  document.removeEventListener('mousemove', handleMouseMove);
                  document.removeEventListener('mouseup', handleMouseUp);
                  
                  // Resume animation after manual scrolling
                  setTimeout(() => {
                    if (cities.length > 0 && citiesContainerRef.current) {
                      const scrollContainer = citiesContainerRef.current;
                      const cardWidth = 180;
                      const originalWidth = cities.length * cardWidth;
                      let scrollPosition = scrollContainer.scrollLeft;
                      let animationId: number;

                      const smoothScroll = () => {
                        scrollPosition += 0.5;
                        
                        if (scrollPosition >= originalWidth) {
                          scrollPosition = 0;
                          scrollContainer.scrollLeft = 0;
                        } else {
                          scrollContainer.scrollLeft = scrollPosition;
                        }
                        
                        animationId = requestAnimationFrame(smoothScroll);
                        setCitiesAnimationId(animationId);
                      };

                      animationId = requestAnimationFrame(smoothScroll);
                      setCitiesAnimationId(animationId);
                    }
                  }, 3000); // Resume after 3 seconds of inactivity
                };
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
              }}
              onMouseEnter={() => {
                // Pause animation on hover
                if (citiesAnimationId) {
                  cancelAnimationFrame(citiesAnimationId);
                  setCitiesAnimationId(null);
                }
              }}
              onMouseLeave={() => {
                // Resume animation when not hovering
                if (cities.length > 0 && citiesContainerRef.current) {
                  const scrollContainer = citiesContainerRef.current;
                  const cardWidth = 180;
                  const originalWidth = cities.length * cardWidth;
                  let scrollPosition = scrollContainer.scrollLeft;
                  let animationId: number;

                  const smoothScroll = () => {
                    scrollPosition += 0.5;
                    
                    // Seamless loop - when reaching halfway through duplicates, reset to beginning
                    if (scrollPosition >= originalWidth) {
                      scrollPosition = 0;
                      scrollContainer.scrollLeft = 0;
                    } else {
                      scrollContainer.scrollLeft = scrollPosition;
                    }
                    
                    animationId = requestAnimationFrame(smoothScroll);
                    setCitiesAnimationId(animationId);
                  };

                  animationId = requestAnimationFrame(smoothScroll);
                  setCitiesAnimationId(animationId);
                }
              }}
              onTouchStart={(e) => {
                // Pause animation on touch
                if (citiesAnimationId) {
                  cancelAnimationFrame(citiesAnimationId);
                  setCitiesAnimationId(null);
                }
              }}
              onTouchEnd={() => {
                // Resume animation after touch
                setTimeout(() => {
                  if (cities.length > 0 && citiesContainerRef.current) {
                    const scrollContainer = citiesContainerRef.current;
                    const cardWidth = 180;
                    const originalWidth = cities.length * cardWidth;
                    let scrollPosition = scrollContainer.scrollLeft;
                    let animationId: number;

                    const smoothScroll = () => {
                      scrollPosition += 0.5;
                      
                      if (scrollPosition >= originalWidth) {
                        scrollPosition = 0;
                        scrollContainer.scrollLeft = 0;
                      } else {
                        scrollContainer.scrollLeft = scrollPosition;
                      }
                      
                      animationId = requestAnimationFrame(smoothScroll);
                      setCitiesAnimationId(animationId);
                    };

                    animationId = requestAnimationFrame(smoothScroll);
                    setCitiesAnimationId(animationId);
                  }
                }, 3000); // Resume after 3 seconds of inactivity
              }}
            >
              {/* Render original items */}
              {cities.map((city, index) => (
                <Link
                  key={`city-original-${index}`}
                  href={`/wedding-photographers?city=${encodeURIComponent(city.name)}`}
                  className="inline-block align-top flex-shrink-0 w-44"
                >
                  <Card className="shadow-lg hover:shadow-xl transition-shadow cursor-pointer h-full flex flex-col">
                    <CardContent className="p-0 flex-grow flex flex-col">
                      <div className="relative h-36 flex-grow">
                        {city.image ? (
                          <NextImage
                            src={city.image}
                            alt={city.name}
                            fill
                            className="object-cover rounded-t-lg"
                          />
                        ) : (
                          <NextImage
                            src="/placeholder.svg"
                            alt={city.name}
                            fill
                            className="object-cover rounded-t-lg"
                          />
                        )}
                      </div>
                      <div className="p-4 flex items-center justify-center flex-grow">
                        <h3 className="text-sm font-semibold text-center text-gray-900">{city.name}</h3>
                      </div>
                    </CardContent>
                  </Card>
                </Link>
              ))}
              
              {/* Render duplicate items for seamless loop */}
              {cities.map((city, index) => (
                <Link
                  key={`city-duplicate-${index}`}
                  href={`/wedding-photographers?city=${encodeURIComponent(city.name)}`}
                  className="inline-block align-top flex-shrink-0 w-44"
                >
                  <Card className="shadow-lg hover:shadow-xl transition-shadow inline-block align-top cursor-pointer h-full flex flex-col">
                    <CardContent className="p-0 flex-grow flex flex-col">
                      <div className="relative h-36 flex-grow">
                        {city.image ? (
                          <NextImage
                            src={city.image}
                            alt={city.name}
                            fill
                            className="object-cover rounded-t-lg"
                          />
                        ) : (
                          <NextImage
                            src="/placeholder.svg"
                            alt={city.name}
                            fill
                            className="object-cover rounded-t-lg"
                          />
                        )}
                      </div>
                      <div className="p-4 flex items-center justify-center flex-grow">
                        <h3 className="text-sm font-semibold text-center text-gray-900">{city.name}</h3>
                      </div>
                    </CardContent>
                  </Card>
                </Link>
              ))}
            </div>
          </div>
        </div>
      </section>

      {/* Other Services */}
      <section className="py-16 bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 className="text-3xl font-bold text-center mb-12 text-gray-900">ShootingWala Other Services</h2>
          <div className="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
            <Card className="shadow-lg hover:shadow-xl transition-shadow">
              <CardContent className="p-0">
                <div className="relative h-64">
                  <NextImage
                    src={albumData.imageUrl || "/placeholder.svg?height=300&width=400"}
                    alt="Digital Album"
                    fill
                    className="object-cover rounded-t-lg"
                  />
                </div>
                <div className="p-6 text-center">
                  <h3 className="text-xl font-bold mb-4 text-gray-900">
                    {albumData.title || "Digital Album"}
                  </h3>
                  <p className={`text-gray-600 mb-4 text-sm text-justify leading-relaxed ${
                    expandedAlbum ? '' : 'line-clamp-2'
                  }`}>
                    {albumData.description || "Create beautiful digital albums for your special moments. Preserve your memories in stunning digital format with customizable layouts, themes, and sharing options."}
                  </p>
                  <Button
                    variant="outline"
                    className="border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-white bg-transparent"
                    onClick={() => setExpandedAlbum(!expandedAlbum)}
                  >
                    {expandedAlbum ? 'Show Less' : 'Know More'}
                  </Button>
                </div>
              </CardContent>
            </Card>
            <Card className="shadow-lg hover:shadow-xl transition-shadow">
              <CardContent className="p-0">
                <div className="relative h-64">
                  <NextImage
                    src={invitationData.imageUrl || "/placeholder.svg?height=300&width=400"}
                    alt="Digital Invitation"
                    fill
                    className="object-cover rounded-t-lg"
                  />
                </div>
                <div className="p-6 text-center">
                  <h3 className="text-xl font-bold mb-4 text-gray-900">
                    {invitationData.eventTitle || "Digital Invitation"}
                  </h3>
                  <p className={`text-gray-600 mb-4 text-sm text-justify leading-relaxed ${
                    expandedInvitation ? '' : 'line-clamp-2'
                  }`}>
                    {invitationData.description || "Design stunning digital invitations for your events. Create personalized invitations with beautiful templates, custom designs, and easy sharing options for weddings, parties, and special occasions."}
                  </p>
                  {expandedInvitation && invitationData.eventDate && (
                    <p className="text-gray-500 text-xs mb-2">{invitationData.eventDate}</p>
                  )}
                  {expandedInvitation && invitationData.eventLocation && (
                    <p className="text-gray-500 text-xs mb-4">{invitationData.eventLocation}</p>
                  )}
                  <Button
                    variant="outline"
                    className="border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-white bg-transparent"
                    onClick={() => setExpandedInvitation(!expandedInvitation)}
                  >
                    {expandedInvitation ? 'Show Less' : 'Know More'}
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </section>

      {/* Real Wedding Stories */}
      <section className="py-16 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 className="text-3xl font-bold text-center mb-12 text-gray-900">Real Wedding Stories</h2>
          
          {stories.length > 0 ? (
            <div className="relative overflow-hidden group">
              {/* Stories Carousel */}
              <div 
                ref={storiesScrollRef}
                className="flex gap-5 touch-pan-x"
                style={{ width: 'max-content', cursor: 'grab' }}
                onMouseDown={(e) => {
                  // Pause animation on mouse down and enable manual scrolling
                  if (storiesAnimationId) {
                    cancelAnimationFrame(storiesAnimationId);
                    setStoriesAnimationId(null);
                  }
                  
                  const scrollContainer = storiesScrollRef.current;
                  if (!scrollContainer) return;
                  
                  const startX = e.pageX - scrollContainer.offsetLeft;
                  const scrollLeft = scrollContainer.scrollLeft;
                  
                  const handleMouseMove = (moveEvent: MouseEvent) => {
                    moveEvent.preventDefault();
                    const x = moveEvent.pageX - scrollContainer.offsetLeft;
                    const walk = (x - startX) * 2; // Scroll speed multiplier
                    scrollContainer.scrollLeft = scrollLeft - walk;
                  };
                  
                  const handleMouseUp = () => {
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                    
                    // Resume animation after manual scrolling
                    setTimeout(() => {
                      if (stories.length > 0 && storiesScrollRef.current) {
                        const scrollContainer = storiesScrollRef.current;
                        const cardWidth = 220;
                        const originalWidth = stories.length * cardWidth;
                        let scrollPosition = scrollContainer.scrollLeft;
                        let animationId: number;

                        const smoothScroll = () => {
                          scrollPosition += 0.5;
                          
                          if (scrollPosition >= originalWidth) {
                            scrollPosition = 0;
                            scrollContainer.scrollLeft = 0;
                          } else {
                            scrollContainer.scrollLeft = scrollPosition;
                          }
                          
                          animationId = requestAnimationFrame(smoothScroll);
                          setStoriesAnimationId(animationId);
                        };

                        animationId = requestAnimationFrame(smoothScroll);
                        setStoriesAnimationId(animationId);
                      }
                    }, 3000); // Resume after 3 seconds of inactivity
                  };
                  
                  document.addEventListener('mousemove', handleMouseMove);
                  document.addEventListener('mouseup', handleMouseUp);
                }}
                onMouseEnter={() => {
                  // Pause animation on hover
                  if (storiesAnimationId) {
                    cancelAnimationFrame(storiesAnimationId);
                    setStoriesAnimationId(null);
                  }
                }}
                onMouseLeave={() => {
                  // Resume animation when not hovering
                  if (stories.length > 0 && storiesScrollRef.current) {
                    const scrollContainer = storiesScrollRef.current;
                    const cardWidth = 220;
                    const originalWidth = stories.length * cardWidth;
                    let scrollPosition = scrollContainer.scrollLeft;
                    let animationId: number;

                    const smoothScroll = () => {
                      scrollPosition += 0.5;
                      
                      // Seamless loop - when reaching halfway through duplicates, reset to beginning
                      if (scrollPosition >= originalWidth) {
                        scrollPosition = 0;
                        scrollContainer.scrollLeft = 0;
                      } else {
                        scrollContainer.scrollLeft = scrollPosition;
                      }
                      
                      animationId = requestAnimationFrame(smoothScroll);
                      setStoriesAnimationId(animationId);
                    };

                    animationId = requestAnimationFrame(smoothScroll);
                    setStoriesAnimationId(animationId);
                  }
                }}
                onTouchStart={(e) => {
                  // Pause animation on touch
                  if (storiesAnimationId) {
                    cancelAnimationFrame(storiesAnimationId);
                    setStoriesAnimationId(null);
                  }
                }}
                onTouchEnd={() => {
                  // Resume animation after touch
                  setTimeout(() => {
                    if (stories.length > 0 && storiesScrollRef.current) {
                      const scrollContainer = storiesScrollRef.current;
                      const cardWidth = 220;
                      const originalWidth = stories.length * cardWidth;
                      let scrollPosition = scrollContainer.scrollLeft;
                      let animationId: number;

                      const smoothScroll = () => {
                        scrollPosition += 0.5;
                        
                        if (scrollPosition >= originalWidth) {
                          scrollPosition = 0;
                          scrollContainer.scrollLeft = 0;
                        } else {
                          scrollContainer.scrollLeft = scrollPosition;
                        }
                        
                        animationId = requestAnimationFrame(smoothScroll);
                        setStoriesAnimationId(animationId);
                      };

                      animationId = requestAnimationFrame(smoothScroll);
                      setStoriesAnimationId(animationId);
                    }
                  }, 3000); // Resume after 3 seconds of inactivity
                }}
              >
                {/* Render original items */}
                {stories.map((story, index) => (
                  <Card key={`story-original-${index}`} className="w-64 h-[420px] flex-shrink-0 shadow-lg hover:shadow-xl transition-shadow overflow-hidden flex flex-col">
                    <div className="relative h-48 w-full flex-shrink-0">
                      <NextImage
                        src={story.imageUrl || "/placeholder.svg?height=300&width=400"}
                        alt={story.title}
                        fill
                        className="object-cover"
                      />
                    </div>
                    <CardContent className="p-4 flex flex-col flex-grow">
                      <h3 className="text-lg font-bold mb-2 text-gray-900 text-center h-14 flex items-center justify-center">{story.title}</h3>
                      <p className="text-gray-600 text-sm text-justify flex-grow overflow-hidden line-clamp-4">{story.content}</p>
                      <div className="flex items-center justify-between mt-4 pt-4 border-t">
                        <span className="text-xs text-gray-500">{story.date}</span>
                        <a 
                          href={`/stories/${'story'}`}
                          className="inline-flex items-center justify-center rounded-md text-xs font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-7 px-3"
                        >
                          Read More
                        </a>
                      </div>
                    </CardContent>
                  </Card>
                ))}
                
                {/* Render duplicate items for seamless loop */}
                {stories.map((story, index) => (
                  <Card key={`story-duplicate-${index}`} className="w-64 h-[420px] flex-shrink-0 shadow-lg hover:shadow-xl transition-shadow overflow-hidden flex flex-col">
                    <div className="relative h-48 w-full flex-shrink-0">
                      <NextImage
                        src={story.imageUrl || "/placeholder.svg?height=300&width=400"}
                        alt={story.title}
                        fill
                        className="object-cover"
                      />
                    </div>
                    <CardContent className="p-4 flex flex-col flex-grow">
                      <h3 className="text-lg font-bold mb-2 text-gray-900 text-center h-14 flex items-center justify-center">{story.title}</h3>
                      <p className="text-gray-600 text-sm text-justify flex-grow overflow-hidden line-clamp-4">{story.content}</p>
                      <div className="flex items-center justify-between mt-4 pt-4 border-t">
                        <span className="text-xs text-gray-500">{story.date}</span>
                        <a 
                          href={`/stories/${'story'}`}
                          className="inline-flex items-center justify-center rounded-md text-xs font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-7 px-3"
                        >
                          Read More
                        </a>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </div>
          ) : (
            <div className="text-center py-12">
              <p className="text-gray-500 text-lg">No wedding stories available yet.</p>
            </div>
          )}
        </div>
      </section>

      {/* Gallery to Look for */}
      <section className="py-16 bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between mb-8">
            <h2 className="text-3xl font-bold text-gray-900">Gallery to Look for</h2>
            <Link href="/gallery">
              <Button variant="outline" className="text-gray-600 hover:text-gray-900">
                View All ‚Üí
              </Button>
            </Link>
          </div>
          
          {galleryCategories.length === 0 ? (
            <div className="text-center py-12">
              <p className="text-gray-500 text-lg">No gallery categories available</p>
              <p className="text-gray-400">Categories will appear here once images are uploaded through the admin panel</p>
            </div>
          ) : (
            <div className="relative overflow-hidden group">
              {/* Horizontal Scrollable Container */}
              <div 
                ref={galleryScrollRef}
                className="flex gap-5 touch-pan-x"
                style={{ 
                  width: 'max-content',
                  scrollbarWidth: 'none', 
                  msOverflowStyle: 'none',
                  cursor: 'grab'
                }}
                onMouseDown={(e) => {
                  // Pause animation on mouse down and enable manual scrolling
                  if (galleryAnimationId) {
                    cancelAnimationFrame(galleryAnimationId);
                    setGalleryAnimationId(null);
                  }
                  
                  const scrollContainer = galleryScrollRef.current;
                  if (!scrollContainer) return;
                  
                  const startX = e.pageX - scrollContainer.offsetLeft;
                  const scrollLeft = scrollContainer.scrollLeft;
                  
                  const handleMouseMove = (moveEvent: MouseEvent) => {
                    moveEvent.preventDefault();
                    const x = moveEvent.pageX - scrollContainer.offsetLeft;
                    const walk = (x - startX) * 2; // Scroll speed multiplier
                    scrollContainer.scrollLeft = scrollLeft - walk;
                  };
                  
                  const handleMouseUp = () => {
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                    
                    // Resume animation after manual scrolling
                    setTimeout(() => {
                      if (galleryCategories.length > 0 && galleryScrollRef.current) {
                        const scrollContainer = galleryScrollRef.current;
                        const cardWidth = 220;
                        const originalWidth = galleryCategories.length * cardWidth;
                        let scrollPosition = scrollContainer.scrollLeft;
                        let animationId: number;

                        const smoothScroll = () => {
                          scrollPosition += 0.5;
                          
                          if (scrollPosition >= originalWidth) {
                            scrollPosition = 0;
                            scrollContainer.scrollLeft = 0;
                          } else {
                            scrollContainer.scrollLeft = scrollPosition;
                          }
                          
                          animationId = requestAnimationFrame(smoothScroll);
                          setGalleryAnimationId(animationId);
                        };

                        animationId = requestAnimationFrame(smoothScroll);
                        setGalleryAnimationId(animationId);
                      }
                    }, 3000); // Resume after 3 seconds of inactivity
                  };
                  
                  document.addEventListener('mousemove', handleMouseMove);
                  document.addEventListener('mouseup', handleMouseUp);
                }}
                onMouseEnter={() => {
                  // Pause animation on hover
                  if (galleryAnimationId) {
                    cancelAnimationFrame(galleryAnimationId);
                    setGalleryAnimationId(null);
                  }
                }}
                onMouseLeave={() => {
                  // Resume animation when not hovering
                  if (galleryCategories.length > 0 && galleryScrollRef.current) {
                    const scrollContainer = galleryScrollRef.current;
                    const cardWidth = 220;
                    const originalWidth = galleryCategories.length * cardWidth;
                    let scrollPosition = scrollContainer.scrollLeft;
                    let animationId: number;

                    const smoothScroll = () => {
                      scrollPosition += 0.5;
                      
                      // Seamless loop - when reaching halfway through duplicates, reset to beginning
                      if (scrollPosition >= originalWidth) {
                        scrollPosition = 0;
                        scrollContainer.scrollLeft = 0;
                      } else {
                        scrollContainer.scrollLeft = scrollPosition;
                      }
                      
                      animationId = requestAnimationFrame(smoothScroll);
                      setGalleryAnimationId(animationId);
                    };

                    animationId = requestAnimationFrame(smoothScroll);
                    setGalleryAnimationId(animationId);
                  }
                }}
                onTouchStart={(e) => {
                  // Pause animation on touch
                  if (galleryAnimationId) {
                    cancelAnimationFrame(galleryAnimationId);
                    setGalleryAnimationId(null);
                  }
                }}
                onTouchEnd={() => {
                  // Resume animation after touch
                  setTimeout(() => {
                    if (galleryCategories.length > 0 && galleryScrollRef.current) {
                      const scrollContainer = galleryScrollRef.current;
                      const cardWidth = 220;
                      const originalWidth = galleryCategories.length * cardWidth;
                      let scrollPosition = scrollContainer.scrollLeft;
                      let animationId: number;

                      const smoothScroll = () => {
                        scrollPosition += 0.5;
                        
                        if (scrollPosition >= originalWidth) {
                          scrollPosition = 0;
                          scrollContainer.scrollLeft = 0;
                        } else {
                          scrollContainer.scrollLeft = scrollPosition;
                        }
                        
                        animationId = requestAnimationFrame(smoothScroll);
                        setGalleryAnimationId(animationId);
                      };

                      animationId = requestAnimationFrame(smoothScroll);
                      setGalleryAnimationId(animationId);
                    }
                  }, 3000); // Resume after 3 seconds of inactivity
                }}
              >
                {/* Render original items */}
                {galleryCategories.map((category, index) => (
                  <Link
                    key={`original-${index}`}
                    href={`/gallery/${encodeURIComponent(category.name.toLowerCase().replace(/\s+/g, '-'))}`}
                    className="block flex-shrink-0 w-52"
                  >
                    <Card className="shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer group hover:-translate-y-2 h-full flex flex-col">
                      <CardContent className="p-0 flex-grow flex flex-col">
                        <div className="relative h-36 overflow-hidden flex-grow">
                          <NextImage
                            src={category.sampleImage}
                            alt={category.name}
                            fill
                            className="object-cover rounded-t-lg group-hover:scale-110 transition-transform duration-300"
                          />
                          <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300"></div>
                          
                          {/* Image Count Badge */}
                          <div className="absolute top-2 right-2 bg-white/90 backdrop-blur-sm text-gray-900 px-2 py-1 rounded-full text-xs font-semibold shadow-sm">
                            {category.imageCount} {category.imageCount === 1 ? 'image' : 'images'}
                          </div>
                        </div>
                        <div className="p-4 flex items-center justify-center flex-grow">
                          <h3 className="font-bold text-base text-gray-900 text-center">{category.name}</h3>
                        </div>
                      </CardContent>
                    </Card>
                  </Link>
                ))}
                
                {/* Render duplicate items for seamless loop */}
                {galleryCategories.map((category, index) => (
                  <Link
                    key={`duplicate-${index}`}
                    href={`/gallery/${encodeURIComponent(category.name.toLowerCase().replace(/\s+/g, '-'))}`}
                    className="block flex-shrink-0 w-52"
                  >
                    <Card className="shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer group hover:-translate-y-2 h-full flex flex-col">
                      <CardContent className="p-0 flex-grow flex flex-col">
                        <div className="relative h-36 overflow-hidden flex-grow">
                          <NextImage
                            src={category.sampleImage}
                            alt={category.name}
                            fill
                            className="object-cover rounded-t-lg group-hover:scale-110 transition-transform duration-300"
                          />
                          <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300"></div>
                          
                          {/* Image Count Badge */}
                          <div className="absolute top-2 right-2 bg-white/90 backdrop-blur-sm text-gray-900 px-2 py-1 rounded-full text-xs font-semibold shadow-sm">
                            {category.imageCount} {category.imageCount === 1 ? 'image' : 'images'}
                          </div>
                        </div>
                        <div className="p-4 flex items-center justify-center flex-grow">
                          <h3 className="font-bold text-base text-gray-900 text-center">{category.name}</h3>
                        </div>
                      </CardContent>
                    </Card>
                  </Link>
                ))}
              </div>
            </div>
          )}
        </div>
      </section>
    </>
  )
}